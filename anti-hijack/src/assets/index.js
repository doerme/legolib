/*!
 * @project : anti-hijack
 * @version : 0.1.0
 * @author  : UED.David
 * @update  : 2017-09-28 4:50:53 pm
 */!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LegoAntiHijack=t():e.LegoAntiHijack=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(1),o=r(i),u=n(2),c=r(u),a=n(21),s=n(22),f=null;e.exports=function(){function e(t){(0,o["default"])(this,e),this.init(t)}return(0,c["default"])(e,[{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.defaults={whiteList:["yy.com","yypm.com","duowan.com","dwstatic.com","yystatic.com","huanju.cn","huanju.net","hiido.com","hiido.cn","huya.com","mezhibo.com","zhiniu8.com","100.com","5253.com","4366.com","1931.com","sealdsp.com","yuanyuantv.com","ruixueys.com","yyclouds.com","kuaikuai.cn","up24.com","bigo.tv","bigolive.cn","baidu.com","qq.com","weibo.com","sina.com.cn","sinaimg.cn","sinajs.cn","google-analytics.com"],blackList:["120.80.57.123","61.160.200.252"]},this.ready(),this.lockCall(),this.lockApply(),this.setSecurityList(e),this.rawDocumentWrite(),this.rawOpener(),this.rawSetAttribute(),this.checkIframeHijack(),this.mutation(),s.init(e)}},{key:"ready",value:function(){this.whiteList=[],this.blackList=[],f=this}},{key:"render",value:function(){}},{key:"beforeDestroy",value:function(){}},{key:"destroyed",value:function(){}},{key:"setSecurityList",value:function(e){this.whiteList=e.whiteList&&a.isArray(e.whiteList)?a.mergeArray(this.defaults.whiteList,e.whiteList):this.defaults.whiteList,this.blackList=e.blackList&&a.isArray(e.blackList)?a.mergeArray(this.defaults.blackList,e.blackList):this.defaults.blackList}},{key:"rawDocumentWrite",value:function(){var e=this,t=arguments,n=document.write,r=document.writeln,i=function(n,r){var i=e.getTestType(n);switch(i){case"xss":s.pushQueue("document write→xss","",n);break;case"blackList":s.pushQueue("document write→黑名单","",n);break;default:s.pushQueue("document write→未拦截","",n),r.apply(document,t)}};document.write=function(e){i(e,n)},document.writeln=function(e){i(e,r)}}},{key:"rawOpener",value:function(){var e=this,t=arguments,n=window.open;window.open=function(r){var i=e.getTestType(r);return"whiteList"!==i?void s.pushQueue("window.open",r,""):void n.apply(window,t)}}},{key:"rawSetAttribute",value:function(){var e=this,t=Element.prototype.setAttribute;Element.prototype.setAttribute=function(n,r){if("SCRIPT"===this.tagName&&/^src$/i.test(n)){var i=e.getTestType(r);if("whiteList"!==i)return void s.pushQueue(this.tagName,r,"")}t.apply(this,arguments)}}},{key:"xssTest",value:function(e){var t=["xss","eHNz","&#120;&#115;&#115;","&#x78;&#x73;&#x73;","\\u0078\\u0073\\u0073","\\x78\\x73\\x73","\\170\\163\\163","data:text/html","alert\\(\\s*\\d+\\)","alert\\(test\\)","hacked","location.href","self.location","top.location","String.fromCharCode","document.cookie","(\\[\\].*){3,}"],n=new RegExp(this.getReg(t),"i");return!!n.test(e)}},{key:"getReg",value:function(e){return"("+e.join("|")+")"}},{key:"getTestType",value:function(e){var t=e.match(/(http:\/\/|https:\/\/)?([^\/]*)/)[2];return this.testList(this.blackList,t)?"blackList":this.testList(this.whiteList,t)?"whiteList":!!this.xssTest(e)&&"xss"}},{key:"testList",value:function(e,t){var n=this.getReg(e);if(n){var r=new RegExp(n,"i");if(r.test(t))return!0}return!1}},{key:"removeRiskNode",value:function(e){e.parentNode.removeChild(e)}},{key:"checkDOMHijack",value:function(e){for(var t=e.addedNodes,n=0;n<t.length;n++){var r=t[n];switch(r.tagName){case"SCRIPT":case"IFRAME":if("IFRAME"===r.tagName&&r.srcdoc)s.pushQueue(r.tagName,r.src,r.srcdoc),this.removeRiskNode(r);else if(r.src){var i=this.getTestType(r.src);"whiteList"!==i&&(s.pushQueue(r.tagName,r.src,""),this.removeRiskNode(r))}break;case"IMG":if(r.src){var o=this.getTestType(r.src);"blackList"===o&&(s.pushQueue(r.tagName,r.src,""),this.removeRiskNode(r))}(r.onload&&this.xssTest(r.onload)||r.onerror&&this.xssTest(r.onerror))&&(s.pushQueue("IMG xss",r.src,r.onload||r.onerror),this.removeRiskNode(r));break;case"A":r.setAttribute("rel","noopener")}}}},{key:"checkIframeHijack",value:function(){var e="iframe_hijack_redirected";if(a.getUrlParam(e))s.pushQueue("iframe重定向",location.href,"");else if(self!=top){var t=location.href.split("#");location.search?t[0]+="&"+e+"=1":t[0]+="?"+e+"=1";try{top.location=t.join("#")}catch(n){}}}},{key:"watchDOMChange",value:function(e,t){var n=f;e.forEach(function(e){n.checkDOMHijack(e)})}},{key:"mutation",value:function(){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(e){var t=new e(this.watchDOMChange),n={childList:!0,subtree:!0};t.observe(document,n)}}},{key:"lockCall",value:function(){Object.defineProperty(Function.prototype,"call",{value:Function.prototype.call,writable:!1,configurable:!1,enumerable:!0})}},{key:"lockApply",value:function(){Object.defineProperty(Function.prototype,"apply",{value:Function.prototype.apply,writable:!1,configurable:!1,enumerable:!0})}}]),e}()},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=n(3),o=r(i);t["default"]=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o["default"])(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){e.exports={"default":n(4),__esModule:!0}},function(e,t,n){n(5);var r=n(8).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(6);r(r.S+r.F*!n(16),"Object",{defineProperty:n(12).f})},function(e,t,n){var r=n(7),i=n(8),o=n(9),u=n(11),c="prototype",a=function(e,t,n){var s,f,l,p=e&a.F,h=e&a.G,d=e&a.S,y=e&a.P,v=e&a.B,m=e&a.W,w=h?i:i[t]||(i[t]={}),k=w[c],b=h?r:d?r[t]:(r[t]||{})[c];h&&(n=t);for(s in n)f=!p&&b&&void 0!==b[s],f&&s in w||(l=f?b[s]:n[s],w[s]=h&&"function"!=typeof b[s]?n[s]:v&&f?o(l,r):m&&b[s]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[c]=e[c],t}(l):y&&"function"==typeof l?o(Function.call,l):l,y&&((w.virtual||(w.virtual={}))[s]=l,e&a.R&&k&&!k[s]&&u(k,s,l)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(10);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(12),i=n(20);e.exports=n(16)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(13),i=n(15),o=n(19),u=Object.defineProperty;t.f=n(16)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return u(e,t,n)}catch(c){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(14);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(16)&&!n(17)(function(){return 7!=Object.defineProperty(n(18)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){e.exports=!n(17)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,n){var r=n(14),i=n(7).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(14);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={getUrlParam:function(e,t){var n=new RegExp("[\\?&#]"+e+"=([^&#]+)","gi"),r=(t||location.href).match(n),i=void 0;return r&&r.length>0?(i=r[r.length-1].split("="),i&&i.length>1?i[1]:""):""},mergeArray:function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)e[n]===t[r]&&e.splice(n,1);for(var n=0;n<t.length;n++)e.push(t[n]);return e},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}}},function(e,t){e.exports={queueArray:[],pushQueue:function(e,t,n){this.queueArray?this.queueArray.push({type:e,url:t,code:n}):this.sendHijack(e,t,n)},sendHijack:function(e,t,n){var r=e?e.toLowerCase():"",i=t?t:"",o=n?n:"",u='HTTP_hijack&report={"type": "'+r+'", "url": "'+i+'", "code": "'+o+'"}',c=this.reportUrl;if(c){var a=new Image;a.src=c+"?"+u}else window.errorReport&&window.errorReport(u)},init:function(e){var t=this;this.reportUrl=e.reportUrl,window.addEventListener("load",function(){t.queueArray.forEach(function(e,n){t.sendHijack(e.type,e.url,e.code)}),t.queueArray=null})}}}])});